<odoo>
<!-- reports/reporte_estado_pago_action.xml -->
<report
    id="report_estado_pago_pdf"
    string="Estado Pago Sucursal"
    model="estado.pago.sucursal.wizard"
    report_type="qweb-pdf"
    name="Insumar_Estadopagos.report_estado_pago_pdf_template"
    file="Insumar_Estadopagos.report_estado_pago"
/>
<template id="report_estado_pago_pdf_template">
    <t t-call="web.html_container">
        <t t-call="web.external_layout">
            <div class="page">
                <h2>Estado pago sucursal <t t-esc="data['sucursal']"/></h2>
                <t t-foreach="data['grouped']" t-as="group">
                    <div style="margin-top:20px;">
                        <h4><t t-esc="group[0][0]"/> - <t t-esc="group[0][1]"/></h4>
                        <table class="table table-sm mt-2" style="width: 100%; border-collapse: collapse;">
                            <thead>
                                <tr>
                                    <th>Factura</th>
                                    <th>Fecha</th>
                                    <th>Vencimiento</th>
                                    <th>Total</th>
                                    <th>Abono</th>
                                    <th>Saldo</th>
                                </tr>
                            </thead>
                            <tbody>
                                <t t-set="subtotal" t-value="0"/>
                                <t t-foreach="group[1]" t-as="factura">
                                    <tr>
                                        <td><t t-esc="factura.name"/></td>
                                        <td><t t-esc="factura.invoice_date"/></td>
                                        <td><t t-esc="factura.invoice_date_due"/></td>
                                        <td><t t-esc="factura.amount_total"/></td>
                                        <td><t t-esc="factura.amount_total - factura.amount_residual"/></td>
                                        <td><t t-esc="factura.amount_residual"/></td>
                                    </tr>
                                    <t t-set="subtotal" t-value="subtotal + factura.amount_residual"/>
                                </t>
                                <tr>
                                    <td colspan="5" style="text-align: right;"><strong>Subtotal</strong></td>
                                    <td><strong><t t-esc="subtotal"/></strong></td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </t>
            </div>
        </t>
    </t>
</template>
</odoo>